name: PR Checks
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  pr-size-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # Check PR size
      - name: Check PR Size
        uses: actions/github-script@v6
        with:
          script: |
            const pr = context.payload.pull_request;
            const additions = pr.additions;
            const deletions = pr.deletions;
            const total = additions + deletions;
            
            let label = '';
            if (total < 50) {
              label = 'size: xs';
            } else if (total < 200) {
              label = 'size: s';
            } else if (total < 400) {
              label = 'size: m';
            } else if (total < 800) {
              label = 'size: l';
              core.warning(`This PR has ${total} lines changed. Consider breaking it into smaller PRs for easier review.`);
            } else {
              label = 'size: xl';
              core.warning(`This PR has ${total} lines changed. Consider breaking it into smaller PRs for easier review.`);
            }
            
            // Add size label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number,
              labels: [label]
            });

  basic-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Check PR has description
        uses: actions/github-script@v6
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr.body || pr.body.trim().length < 10) {
              core.setFailed('PR description is too short. Please add a meaningful description.');
            }
      
      - name: Check for linked issue
        uses: actions/github-script@v6
        with:
          script: |
            const pr = context.payload.pull_request;
            const body = pr.body || '';
            const hasLinkedIssue = /(?:close[sd]?|fix(?:e[sd])?|resolve[sd]?)\s+#\d+/i.test(body);
            
            if (!hasLinkedIssue) {
              core.warning('Consider linking this PR to an issue using "Closes #123" or "Fixes #123"');
            }